# Emerald ERP - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–æ–µ–∫—Ç–æ–º –ª–æ–∫–∞–ª—å–Ω–æ.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
npm run db:reset

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ [http://localhost:5000](http://localhost:5000)

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- **SQLite** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (`.local/emerald_erp.db`)
- **PostgreSQL** –¥–ª—è production (—á–µ—Ä–µ–∑ DATABASE_URL)

**–í–∞–∂–Ω–æ:** –°—Ö–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å `pgTable` (PostgreSQL), –Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite.
–≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î.

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ë–î

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã:

```bash
npm run db:verify
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –°—É—â–µ—Å—Ç–≤—É—é—Ç –ª–∏ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
- –ï—Å—Ç—å –ª–∏ –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (roles, stage_types, users)

### –°–±—Ä–æ—Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î –∏–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞:

```bash
npm run db:reset
```

–≠—Ç–æ:
1. –£–¥–∞–ª–∏—Ç —Å—Ç–∞—Ä—É—é –±–∞–∑—É
2. –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–æ–π
3. –ó–∞–ø—É—Å—Ç–∏—Ç seed-—Å–∫—Ä–∏–ø—Ç—ã (—Ä–æ–ª–∏, —Ç–∏–ø—ã —ç—Ç–∞–ø–æ–≤)

**–í–Ω–∏–º–∞–Ω–∏–µ:** –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –ø–æ—è–≤–∏–ª–∏—Å—å –æ—à–∏–±–∫–∏ "no such column":

```bash
npm run db:fix-columns
```

–°–∫—Ä–∏–ø—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

### –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```bash
# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–µ–º—ã)
npm run db:generate

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –ë–î
npm run db:push
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è pgTable/SQLite, drizzle-kit –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
–í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm run db:reset`.

## üîç –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—à–∏–±–∫–∞ "no such column"

**–°–∏–º–ø—Ç–æ–º—ã:**
```
SqliteError: no such column: projects.project_number
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –∫–æ–¥–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∏
npm run db:fix-columns

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (–µ—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç 1 –Ω–µ –ø–æ–º–æ–≥)
npm run db:reset
```

### 2. –û—à–∏–±–∫–∞ "Failed to fetch users/roles/etc"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞
node create-roles-and-permissions.mjs

# –°–æ–∑–¥–∞—Ç—å —Ç–∏–ø—ã —ç—Ç–∞–ø–æ–≤
npx tsx server/seed-stage-types.ts
```

### 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (`tsx watch`) –∫–µ—à–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä (Ctrl+C)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run db:fix-columns` –∏–ª–∏ `npm run db:reset`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (`npm run dev`)

### 4. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π (deals vs sales)

**–ü—Ä–æ–±–ª–µ–º–∞:** Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "deals", –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö "sales"

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `"sales"` –≤–µ–∑–¥–µ. Frontend —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤ [RolePermissionsDialog.tsx:32](client/src/components/RolePermissionsDialog.tsx#L32)

## üìù Workflow —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã/–∫–æ–ª–æ–Ω–∫–∏

1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ö–µ–º—É –≤ `shared/schema.ts`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î: `npm run db:verify`
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:
   ```bash
   npm run db:fix-columns  # –∏–ª–∏ db:reset
   ```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä

### –†–∞–±–æ—Ç–∞ —Å —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏

```bash
# –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª–∏
node create-roles-and-permissions.mjs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –≤ –ë–î
node check_permissions.mjs
```

### –†–∞–±–æ—Ç–∞ —Å —Ç–∏–ø–∞–º–∏ —ç—Ç–∞–ø–æ–≤ (Stage Types)

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã —ç—Ç–∞–ø–æ–≤
npx tsx server/seed-stage-types.ts

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã
npx tsx server/activate-new-stage-types.ts
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `drizzle-kit push` –Ω–∞–ø—Ä—è–º—É—é**
   –ò–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è pgTable/SQLite –æ–Ω –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm run db:reset`.

2. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ë–î –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º**
   ```bash
   npm run db:verify
   ```

3. **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.local/emerald_erp.db`**
   –≠—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞, —É –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–≤–æ—è.

4. **–ü—Ä–∏ pull —Å –≤–µ—Ç–∫–∏ main**
   ```bash
   git pull
   npm install          # –Ω–∞ —Å–ª—É—á–∞–π –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   npm run db:verify    # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
   # –ï—Å–ª–∏ –Ω—É–∂–Ω–æ - npm run db:reset
   npm run dev
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Drizzle ORM Docs](https://orm.drizzle.team/docs/overview)
- [Better SQLite3](https://github.com/WiseLibs/better-sqlite3)
- –°—Ö–µ–º–∞ –ë–î: `shared/schema.ts`
- –ú–∏–≥—Ä–∞—Ü–∏–∏: `migrations/`
- Seed-—Å–∫—Ä–∏–ø—Ç—ã: `server/seed-*.ts`, `create-*.mjs`

## üÜò –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ —ç—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run db:verify` –∏ –ø—Ä–∏—à–ª–∏—Ç–µ –≤—ã–≤–æ–¥
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ SQL –æ—à–∏–±–æ–∫
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ `npm run db:reset` –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-10
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
