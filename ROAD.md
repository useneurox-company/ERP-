# ROAD - План разработки

## Дата: 2025-11-21
## Задача: Отображение сроков и файлов в задачах позиций проекта

---

## ФАЗА 1: ПЛАНИРОВАНИЕ (Агент-Планировщик)

### Промпт для Агента-Исполнителя:
> Улучшить отображение задач в позициях проекта:
> 1. Найти компонент, который отображает задачи в позициях проекта
> 2. Добавить отображение срока выполнения задачи (deadline/due_date)
> 3. Добавить отображение количества прикрепленных файлов с иконкой
> 4. Сделать файлы кликабельными для просмотра
> 5. Протестировать UI
> 6. Обновить CHANGELOG.md
> 7. Создать commit

### Разбивка на этапы:
1. **Этап 1:** Найти компонент задач в позициях проекта (вероятно TaskList или ProjectItemDialog)
2. **Этап 2:** Добавить отображение срока (due_date) с форматированием даты
3. **Этап 3:** Добавить иконку и счетчик файлов (attachments)
4. **Этап 4:** Добавить клик на файлы для просмотра
5. **Этап 5:** Протестировать в браузере
6. **Этап 6:** Обновить CHANGELOG.md
7. **Этап 7:** Создать commit

### Дизайн решения:

#### Отображение срока:
- Показать дату в формате "ДД.MM.YYYY" или относительно ("через 2 дня", "просрочено")
- Использовать цветовую индикацию:
  - Зеленый: срок > 3 дней
  - Желтый: срок 1-3 дня
  - Красный: просрочено или срок < 1 дня
- Иконка календаря рядом с датой

#### Отображение файлов:
- Иконка скрепки/файла + количество файлов
- При клике открыть preview или список файлов
- Если файлов нет - не показывать иконку

### План тестирования:
- [ ] **Тест 1:** Открыть позицию проекта с задачами
- [ ] **Тест 2:** Увидеть сроки задач с правильным форматированием
- [ ] **Тест 3:** Увидеть количество файлов
- [ ] **Тест 4:** Кликнуть на файлы и увидеть их
- [ ] **Тест 5:** Проверить цветовую индикацию сроков

### Проверка безопасности:
- [x] Не удаляем базу данных на сервере 147.45.146.149
- [x] Не используем git clean / git reset --hard
- [x] Изменения только в UI (frontend)
- [x] Не затрагиваем существующие данные

---

## ФАЗА 2: ИСПОЛНЕНИЕ (Агент-Исполнитель)

### Шаг 1: Найти компонент задач ✅
**Статус:** ✅ Завершено

**Что сделано:**
- Нашел компонент `ProjectItemTasksSection` в `client/src/pages/ProjectDetailPage.tsx:186-300`
- Компонент отображает задачи для позиций проекта
- Проверил API endpoint `/api/projects/:projectId/items/:itemId/tasks`
- Убедился что задачи возвращают поля `deadline` и `attachments_count`

### Шаг 2: Добавить отображение сроков и файлов ✅
**Статус:** ✅ Завершено

**Что сделано:**
- Добавлена функция `getDaysUntilDeadline()` для расчета оставшихся дней
- Добавлена функция `getDeadlineColor()` с цветовой индикацией:
  - Красный: просрочено или срок <= 1 день
  - Желтый: срок 2-3 дня
  - Зеленый: срок > 3 дней
- Добавлена функция `formatDeadline()` для форматирования текста:
  - "Просрочено X д."
  - "Сегодня (ДД.ММ)"
  - "Завтра (ДД.ММ)"
  - "Через X д. (ДД.ММ)"
  - "ДД.ММ" (если > 7 дней)
- Добавлено отображение иконки Calendar с дедлайном (lines 265-270)
- Добавлено отображение иконки Paperclip с количеством файлов (lines 271-276)
- Добавлен импорт иконки Paperclip из lucide-react

---
